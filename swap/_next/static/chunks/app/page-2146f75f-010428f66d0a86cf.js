"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5678],{96038:function(e,t,n){n.d(t,{Q:function(){return a},Wizard:function(){return s}});var o=n(39804),l=n(93889);const i=(0,l.createContext)({}),a=()=>(0,l.useContext)(i),s=e=>{let{children:t}=e;const[n,a]=(0,l.useState)(null);return(0,o.jsxs)("div",{className:"w-full max-w-[800px] relative rounded-[16px] border border-primary-200 p-[16px] md:p-[32px] overflow-hidden",children:[(0,o.jsx)(i.Provider,{value:{overlayContainer:n},children:t}),(0,o.jsx)("div",{className:"wizard__overlays absolute top-0 left-0 w-full h-full empty:hidden [&>*]:absolute [&>*]:top-0 [&>*]:left-0 [&>*]:w-full [&>*]:h-full",ref:a})]})}},60055:function(e,t,n){var o=n(39804),l=n(93889),i=n(35734),a=n(47177),s=n.n(a),r=n(8074),d=n(37806),u=n(43774),c=n(85522),v=n(25759);t.Z=e=>{let{modalController:t,minSlippagePercent:n=0,maxSlippagePercent:a=100}=e;const p=(0,v.E)(),m=(0,l.useMemo)((()=>r.z.object({slippagePercent:r.z.coerce.number().refine((e=>e>=n),{message:"Slippage tolerance must not be negative."}).refine((e=>e<=a),{message:"Slippage tolerance must not be greater than ".concat(a,"%.")})})),[n,a]),{handleSubmit:w,control:k}=(0,i.cI)({resolver:(0,d.F)(m),defaultValues:{slippagePercent:p.slippagePercent}}),x=(0,l.useMemo)((()=>w((e=>{let{slippagePercent:n}=e;console.log("Form submitted"),p.setSlippagePercent(n),t.close()}))),[w,t,p]),h=(0,l.useCallback)((e=>{e||t.close()}),[t]);return(0,o.jsx)(u.QA,{title:"Slippage Tolerance",titleIsLeftAligned:!0,size:"sm",isOpen:t.isOpen,onOpenChange:h,children:(0,o.jsxs)("form",{onSubmit:x,className:s()("flex flex-col"),children:[(0,o.jsx)(i.Qr,{control:k,name:"slippagePercent",render:e=>{let{field:{ref:t,onChange:l,value:i,...s},fieldState:r}=e;var d;return(0,o.jsx)(c.y,{inputRef:t,value:null==i?void 0:i.toString(),type:"number",label:"Slippage Tolerance (%)",step:".1",min:n,max:a,required:!0,"data-qa":"slippage-tolerance-input",isError:!!r.error,hint:null===(d=r.error)||void 0===d?void 0:d.message,onValueChange:e=>{if(""===e)return;const t=Number.parseFloat(e);t<0||t>a||l(t.toFixed(1))},...s})}}),(0,o.jsx)(u.C_,{children:(0,o.jsx)(u.Qd,{type:"submit",children:"Confirm"})})]})})}},1674:function(e,t,n){n.d(t,{SwapExperience:function(){return me}});var o=n(39804),l=n(93889),i=n(6843),a=n(47177),s=n.n(a),r=n(96842),d=n(15725),u=n(4373),c=n(41498),v=n(28345),p=n(84664),m=n(43519),w=n(8025),k=n(33501),x=n(81395),h=n(12307),f=n(35276),g=n(42976),b=n(74499),j=n(8411),y=n(41919),N=n(72174),S=n(47476),C=n(32425),A=n(90769),I=n(81815),P=n(51411),T=n(797),E=n(94095);const O=e=>(0,o.jsx)("button",{...e,className:"text-neutral-50 bg-primary-600 px-[8px] py-[2px] rounded-[4px]",children:"MAX"});var F=n(28621),_=n.n(F),M=n(51434),Z=n.n(M),z=n(61777),D=n(5923),K=n(30854),R=n(23712),U=n(25759),W=n(11016);const Y=()=>{var e,t,n,i,a,r,d,c;const{address:v}=(0,u.useAccount)(),{source:p,destination:m}=(0,U.E)(),{data:w}=(0,S.S2)({networkId:null==p||null===(e=p.network)||void 0===e?void 0:e.id}),k=(0,l.useMemo)((()=>{var e;if(w&&(null==p||null===(e=p.network)||void 0===e?void 0:e.id))return w.find((e=>{let{id:t}=e;return t.toLowerCase()===h.hx}))}),[null==p||null===(t=p.network)||void 0===t?void 0:t.id,w]),{data:x={dstAmount:"0",gas:0},isFetching:f}=(0,S.dy)({fromNetworkId:null==p||null===(n=p.network)||void 0===n?void 0:n.id,toNetworkId:null==m||null===(i=m.network)||void 0===i?void 0:i.id,fromTokenAddress:null==p||null===(a=p.token)||void 0===a?void 0:a.id,toTokenAddress:null==m||null===(r=m.token)||void 0===r?void 0:r.id,amount:(null==p?void 0:p.token)&&(null==p?void 0:p.amount)?p.amount.toString():void 0,walletAddress:v},{enabled:!!((null==p?void 0:p.network)&&(null==m?void 0:m.network)&&(null==p?void 0:p.token)&&(null==m?void 0:m.token)&&p.amount),refetchInterval:P.FF}),{data:g}=(0,S.t1)({networkId:null==p||null===(d=p.network)||void 0===d?void 0:d.id,options:{enabled:!!(null==p||null===(c=p.network)||void 0===c?void 0:c.id)}}),{getOneInchGasPrice:b}=(0,D.Z)({gasPrices:g}),j=(0,l.useMemo)((()=>{if(!k||void 0===(null==x?void 0:x.gas))return;if(0===x.gas)return 0;const e=b(),t=(0,R.Z)({gasAmount:x.gas,gasPrice:e});return t?(0,z.An)(t,k.attributes.decimal):0}),[k,null==x?void 0:x.gas,b]),{tokenPriceInUSD:y}=(0,K.Z)({network:null==p?void 0:p.network,token:k}),N=(0,l.useMemo)((()=>{if(!j)return;const e=j*y;return e<1e-5?"<$0.00001":"≈$".concat((0,W.g)(e,5))}),[j,y]),C=(0,l.useMemo)((()=>{if(!k)return;const e=null!=j?j:0;return e<1e-8?"<0.00000001  ".concat(k.attributes.symbol):"≈".concat((0,W.g)(e,5)," ").concat(k.attributes.symbol)}),[j,k]);return(0,o.jsx)("span",{className:s()({"animate-pulse-4x":f}),children:[C,N?"(".concat(N,")"):void 0].filter(Z()(_())).join(" ")||"N/A"})};var B=n(97128),$=n(53045),q=n(43774),L=n(60188),Q=n(64942);const V=e=>{let{operation:t}=e;return(0,o.jsxs)("div",{className:"flex flex-col py-[16px] gap-[16px] items-center justify-center",children:[(0,o.jsx)("div",{className:"text-center text-sm",children:"You transaction has been recorded and will be processed shortly."}),(0,o.jsx)("div",{children:(0,o.jsx)(B.$j,{size:"md"})}),t.type===Q.Ez.CrossChain&&(0,o.jsx)("div",{className:"text-center text-sm",children:"Please keep this page open until the transaction is completed. Do not close this page or switch to a different tab."})]})},G=()=>(0,o.jsxs)("div",{className:"flex flex-col py-[16px] gap-[16px] items-center justify-center",children:[(0,o.jsx)("div",{className:"text-center text-sm",children:"You transaction has completed successfully."}),(0,o.jsx)("div",{children:(0,o.jsx)($.Z,{className:"icon-[48px] text-green-800"})})]}),H=e=>{let{error:t}=e;return(0,o.jsxs)("div",{className:"flex flex-col py-[16px] gap-[16px] items-center justify-center",children:[(0,o.jsx)("div",{className:"text-center text-sm",children:"You transaction has failed."}),(0,o.jsx)("div",{children:(0,o.jsx)(L.W,{className:"icon-[48px]"})}),(0,o.jsx)("div",{className:"w-full p-[16px] rounded-md bg-secondary-100 text-sm",children:t})]})},X={},J={[Q.Nc.Unknown]:"Transaction status unknown...",[Q.Nc.Pending]:"Transaction in progress...",[Q.Nc.Completed]:"Transaction completed",[Q.Nc.Failed]:"Transaction failed"},ee=e=>{let{operation:t,onClose:n,...i}=e;return console.log("SwapOperationStatusModal::operation",t),(0,l.useEffect)((()=>{if(t){const e=X[t.status];if(e&&n){const t=window.setTimeout((()=>{console.log("Closing modal"),n()}),e);return()=>{window.clearTimeout(t)}}}}),[t,n]),t?(0,o.jsxs)(q.QA,{...i,title:J[t.status],titleIsLeftAligned:!0,size:"sm",className:"p-[24px]",onOpenChange:n,children:[t.status===Q.Nc.Pending&&(0,o.jsx)(V,{operation:t}),t.status===Q.Nc.Completed&&(0,o.jsx)(G,{}),t.status===Q.Nc.Failed&&(0,o.jsx)(H,{error:t.error})]}):null};var te=n(47519),ne=n(72753),oe=n(48780);const le=e=>{let{estimatedKarma:t,isDataStale:n}=e;return(0,o.jsx)("div",{className:"rounded-[16px] p-[16px] bg-secondary-100 border-2 border-secondary-100",children:(0,o.jsx)(T.s,{className:"tabular-uniform [&>.label]:text-neutral-600 [&>.content]:text-neutral-400",children:(0,o.jsx)(T.s.Row,{label:"You will recieve",children:(0,o.jsxs)("span",{className:s()("flex gap-1 justify-center items-center",{"animate-pulse-4x":n}),children:[(0,o.jsxs)("span",{className:"chip py-1 px-2 gap-1 bg-secondary-500 text-base-text-white",children:[(0,o.jsx)(oe.e,{className:"w-[10px]"})," ",(0,o.jsx)("span",{className:"opacity-80 text-[12px] font-medium",children:t})]}),(0,o.jsx)("span",{children:"Karma Points"})]})})})})};var ie=n(18951),ae=n(57570);const se=[{pattern:/swap amount too small/i,message:"Amount too small to swap"},{pattern:/token not supported/i,message:"The selected pair of tokens is not available for cross-chain swap"}],re=e=>{let{children:t,className:n,...l}=e;return(0,o.jsx)("button",{...l,className:s()("msq-btn msq-btn-lg w-full whitespace-nowrap msq-btn-primary",n),children:t})},de=()=>{const e=(0,w.fI)(),t=(0,l.useCallback)((()=>{e.open()}),[e]);return(0,o.jsx)(re,{onClick:t,children:"Sign in"})},ue=e=>{let{disabled:t}=e;var n,l,i,a;const{track:s}=(0,k.K)(),{user:r}=(0,m.aC)(),{source:d}=(0,U.E)(),{address:v}=(0,u.useAccount)(),{mutateAsync:p}=(0,S.p1)(),{refetch:w}=(0,S.VK)({networkId:null===(n=d.network)||void 0===n?void 0:n.id,apiOptions:(null===(l=d.token)||void 0===l?void 0:l.id)&&v?{searchParams:{tokenAddress:null===(i=d.token)||void 0===i?void 0:i.id,walletAddress:v}}:void 0}),{sendTransactionAsync:h}=(0,c.useSendTransaction)();return(0,o.jsx)(re,{disabled:t,onClick:async()=>{if(!d.network||!d.token||!d.amount)return;s(A.oH.SWAP_GIVE_PERMISSION_BUTTON_CLICK,{distinct_id:null==r?void 0:r.id});const e=await p({networkId:d.network.id,options:{searchParams:{tokenAddress:d.token.id,amount:d.amount.toString()}}});console.log("tx.data",e.data);const t=await h({...e.data});if(console.log("Transaction hash:",t),!t)return;const n=x.g.chains.find((e=>{let{id:t}=e;var n;return t===(null===(n=d.network)||void 0===n?void 0:n.id)}));n&&(await(0,b.N)(t,n.id),console.log("Refetching allowance..."),await w())},children:"Give permission to swap ".concat(null===(a=d.token)||void 0===a?void 0:a.attributes.symbol)})},ce=e=>{let{disabled:t}=e;var n,a,s,r,d;const{track:c}=(0,k.K)(),{exportOperationSpecification:v,resetAmounts:p}=(0,U.E)(),{source:w,destination:x,slippagePercent:h}=v(),{userWallet:g}=(0,N.Z)(),{user:b}=(0,m.aC)();var I;const{refetch:T}=(0,ne.m)({address:null==g?void 0:g.attributes.address,chainId:null==w||null===(n=w.network)||void 0===n?void 0:n.id,token:null!==(I=null==w?void 0:w.token)&&void 0!==I?I:void 0}),{address:O}=(0,u.useAccount)(),{data:F}=(0,S.dy)({fromNetworkId:null===(a=w.network)||void 0===a?void 0:a.id,toNetworkId:null===(s=x.network)||void 0===s?void 0:s.id,fromTokenAddress:null===(r=w.token)||void 0===r?void 0:r.id,toTokenAddress:null===(d=x.token)||void 0===d?void 0:d.id,amount:w.token&&w.amount?w.amount.toString():void 0,walletAddress:O},{enabled:!!(w.network&&x.network&&w.token&&x.token&&w.amount),refetchInterval:P.FF}),{initiateSwapOperation:_,markSwapOperationAsCompleted:M,markSwapOperationAsFailed:Z}=(0,te.S)(),{getUserWalletType:z}=(0,y.Z)(),{walletType:D,userWallet:K}=z(),R=(0,l.useMemo)((()=>!t&&w.amount&&w.network&&w.token&&x.amount&&x.network&&x.token),[w,x,t]),W=(0,l.useCallback)((async()=>{const e=Date.now();if(w.token)if(x.token)try{if(!F)return;c(A.oH.SWAP_BUTTON_CLICK,{distinct_id:null==b?void 0:b.id});const{data:t}=await T();if(!t)throw new Error("Failed to update wallet balance.");if(w.amount>t.value)throw new Error("Your wallet balance is below the specified amount. Please adjust the amount to swap and try again.");if(w.network.id===x.network.id){console.log("Initiating a single chain swap operation...");const t=await Promise.race([_({source:w,destination:x,slippagePercent:h},F),(0,j.Z)({walletType:D,address:K.attributes.address,toastId:e,showExtraInfo:!0,hideRetryButton:!0,title:"Swapping ".concat(w.token.attributes.symbol," to ").concat(x.token.attributes.symbol,"...")})]);console.log("After initiating sigle-chain swap operation",t);try{t.hash?(console.log("Storing swap transaction..."),await(0,C.cG)({networkId:w.network.id,options:{json:{tx:t.hash,operationId:t.id}}}),console.log("Swap transaction stored, Marking swap operation with id ".concat(t.id," as completed...")),M(t.id),console.log("Dismissing toast with id:",e),i.Am.dismiss(e),p(),await T()):(console.log("Dismissing toast with id:",e),i.Am.dismiss(e))}catch(e){throw Z(t.id,(0,E.e)(e)),e}}else console.log("Initiating a cross-chain swap operation..."),await _({source:w,destination:x,slippagePercent:h},F)}catch(e){console.error("Error while swapping tokens:",e),(0,f.Z)({error:e,justReturnHandledMessage:!0})}else console.warn("Destination token not selected.");else console.warn("Source token not selected.")}),[w,x,F,T,_,h,D,K.attributes.address,M,p,Z]);return(0,o.jsx)(re,{disabled:!R,onClick:W,children:"Swap"})},ve=e=>{let{disabled:t}=e;var n,i,a,s,r,d,c;const{isAuth:v}=(0,m.aC)(),{source:p,destination:w}=(0,U.E)(),{address:k}=(0,u.useAccount)(),{data:x}=(0,S.VK)({networkId:null===(n=p.network)||void 0===n?void 0:n.id,apiOptions:(null===(i=p.token)||void 0===i?void 0:i.id)&&k?{searchParams:{tokenAddress:null===(a=p.token)||void 0===a?void 0:a.id,walletAddress:k}}:void 0,options:{enabled:!!((null===(s=p.network)||void 0===s?void 0:s.id)&&(null===(r=p.network)||void 0===r?void 0:r.id)===(null===(d=w.network)||void 0===d?void 0:d.id)&&(null===(c=p.token)||void 0===c?void 0:c.id)&&k)}}),h=(0,l.useMemo)((()=>{var e,t,n;return p.token&&I.O$.from(null!==(t=p.amount)&&void 0!==t?t:0).lte(I.O$.from(null!==(n=null==x||null===(e=x.data)||void 0===e?void 0:e.allowance)&&void 0!==n?n:0))}),[p,x]);return v?!1===h?(0,o.jsx)(ue,{disabled:t}):(0,o.jsx)(ce,{disabled:t}):(0,o.jsx)(de,{})},pe=()=>(0,o.jsx)("div",{className:"rounded-[16px] p-[16px] bg-primary-50 border-2 border-primary-50",children:(0,o.jsxs)(T.s,{className:"tabular-uniform [&>.label]:text-neutral-400 [&>.content]:text-neutral-500",children:[(0,o.jsx)(T.s.Row,{label:"Provider",children:(0,o.jsx)(p.Z,{className:"h-[32px]"})}),(0,o.jsx)(T.s.Row,{label:"Transaction fee",children:(0,o.jsx)(Y,{})}),(0,o.jsx)(T.s.Row,{label:"Slippage tolerance",children:(0,o.jsx)(ie.j,{})})]})}),me=()=>{var e,t,n,i,a,s,c,p,m;const w=(0,d.O_)(),{source:k,destination:x,getSource:f,updateSource:b,updateDestination:j}=(0,U.E)(),{userWallet:y}=(0,N.Z)(),{switchChain:C}=(0,g.o$)();var A;const{data:I}=(0,ne.m)({address:null==y?void 0:y.attributes.address,chainId:null==k||null===(e=k.network)||void 0===e?void 0:e.id,token:null!==(A=null==k?void 0:k.token)&&void 0!==A?A:void 0}),T=(0,l.useCallback)((()=>{(null==k?void 0:k.token)&&void 0!==I&&b({amount:I})}),[null==k?void 0:k.token,I,b]),F=(0,l.useCallback)((e=>{b(e)}),[b]),_=(0,l.useCallback)((e=>{j(e)}),[j]),M=(0,l.useCallback)((async()=>{var e,t,n;(null==k||null===(e=k.network)||void 0===e?void 0:e.id)&&(console.log("handleNetworkChangedByUser: Updating wallet network to",{"source?.network?.id":null==k||null===(t=k.network)||void 0===t?void 0:t.id}),await C({destChainId:null==k||null===(n=k.network)||void 0===n?void 0:n.id,terminateConnectionOnError:!1}))}),[null==k||null===(t=k.network)||void 0===t?void 0:t.id,C]);(0,l.useEffect)((()=>{M()}),[null==k||null===(n=k.network)||void 0===n?void 0:n.id,M]);const{chain:Z}=(0,u.useAccount)(),{data:z}=(0,S.zm)();(0,l.useEffect)((()=>{var e;const t=f();var n;(null==Z?void 0:Z.id)&&(null===(e=t.network)||void 0===e?void 0:e.id)!==(null==Z?void 0:Z.id)&&z&&(console.log("update source because network changed externally",{"currentSource.network?.id":null===(n=t.network)||void 0===n?void 0:n.id,"chain?.id":null==Z?void 0:Z.id}),b({network:z.find((e=>{let{id:t}=e;return t===Z.id})),token:null,amount:0n}))}),[f,null==Z?void 0:Z.id,z,b]);const{data:D,isFetching:K,error:R}=(0,S.dy)({fromNetworkId:null==k||null===(i=k.network)||void 0===i?void 0:i.id,toNetworkId:null==x||null===(a=x.network)||void 0===a?void 0:a.id,fromTokenAddress:null==k||null===(s=k.token)||void 0===s?void 0:s.id,toTokenAddress:null==x||null===(c=x.token)||void 0===c?void 0:c.id,amount:(null==k?void 0:k.token)&&(null==k?void 0:k.amount)?k.amount.toString():void 0,walletAddress:null==y?void 0:y.attributes.address},{enabled:!!((null==k?void 0:k.network)&&(null==x?void 0:x.network)&&(null==k?void 0:k.token)&&(null==x?void 0:x.token)&&(null==k?void 0:k.amount)),refetchInterval:P.FF});(0,l.useEffect)((()=>{var e;R?j({amount:0n}):D&&(null==x||null===(e=x.token)||void 0===e?void 0:e.attributes.decimal)&&j({amount:BigInt(D.dstAmount)})}),[j,D,R,null==x||null===(p=x.token)||void 0===p?void 0:p.attributes.decimal]);const W=(0,l.useCallback)((()=>{b({...x,amount:0n}),j({...k,amount:0n})}),[k,x,b,j]),{operations:Y,purgeSwapOperation:B}=(0,te.S)(),$=(0,l.useCallback)((()=>{B(Y[0].id)}),[Y,B]);var q;const{data:L}=(0,ne.m)({address:null==y?void 0:y.attributes.address,chainId:null==k||null===(m=k.network)||void 0===m?void 0:m.id,token:null!==(q=null==k?void 0:k.token)&&void 0!==q?q:void 0}),[Q,V]=(0,l.useState)(!1);(0,l.useEffect)((()=>{void 0!==(null==k?void 0:k.amount)&&V(void 0!==L&&k.amount>L)}),[L,k.amount]);const G=(0,l.useMemo)((()=>{var e;const t=[];var n,o,l,i,a;k.network&&x.network&&k.network.id!==x.network.id&&(null===(e=k.token)||void 0===e?void 0:e.id)===h.hx&&t.push({message:"Swapping native tokens is not supported.",tooltip:"Swapping native tokens is not supported. Swap ".concat(null===(n=k.token)||void 0===n?void 0:n.attributes.symbol," to wrapped ").concat(null===(o=k.token)||void 0===o?void 0:o.attributes.symbol," first and then swap wrapped ").concat(null===(l=k.token)||void 0===l?void 0:l.attributes.symbol," to ").concat(null===(i=x.token)||void 0===i?void 0:i.attributes.symbol,".")});void 0!==(null==k?void 0:k.amount)&&void 0!==L&&k.amount>L&&t.push({message:"There's not enough ".concat(null==k||null===(a=k.token)||void 0===a?void 0:a.attributes.symbol," in your wallet")});return t}),[k,x,L]),H=(0,l.useMemo)((()=>{const e=[];if(!R)return e;const t=(0,E.e)(R);var n,o;return R instanceof r.B?e.push((n=t,null!==(o=se.find((e=>{let{pattern:t}=e;return t.test(n)})))&&void 0!==o?o:{message:"Unknown error"})):e.push({message:t}),e}),[R]);return(0,o.jsxs)("div",{className:"flex flex-col gap-[32px]",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)(ae.h,{label:"You pay",data:k,headerControls:w&&(null==y?void 0:y.attributes.address)&&(0,o.jsx)(O,{onClick:T}),onChange:F,error:G[0]}),(0,o.jsx)("div",{className:"flex flex-row items-center justify-center overflow-visible h-[16px]",children:(0,o.jsx)("div",{className:"flex flex-row items-center justify-center size-[60px] bg-neutral-50 rounded-full",children:(0,o.jsx)("button",{className:"flex flex-row items-center justify-center size-[48px] bg-primary-100 rounded-full",children:(0,o.jsx)(v.Z,{onClick:W,className:"icon-[24px] rotate-90 text-secondary-700"})})})}),(0,o.jsx)(ae.h,{label:"You receive",data:x,isReadOnly:!0,isDataStale:w&&K,onChange:_,error:H[0]})]}),(0,o.jsxs)("div",{className:"flex flex-col gap-[32px]",children:[(0,o.jsx)(ve,{disabled:Q||!!R||G.length>0||H.length>0}),(0,o.jsx)(pe,{}),(0,o.jsx)(le,{estimatedKarma:(null==D?void 0:D.estimatedKarma)||0,isDataStale:w&&K})]}),(0,o.jsx)(ee,{open:!!Y[0],operation:Y[0],onClose:$})]})}}}]);
//# sourceMappingURL=page-2146f75f-010428f66d0a86cf.js.map